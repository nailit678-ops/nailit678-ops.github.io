<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBER-CRM 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
        
        :root {
            --neon-pink: #ff00ff;
            --neon-blue: #00fbff;
            --cyber-black: #050505;
        }

        body {
            background-color: var(--cyber-black);
            color: var(--neon-blue);
            font-family: 'Orbitron', sans-serif, "Microsoft YaHei";
            overflow-x: hidden;
        }

        .cyber-card {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 10px rgba(0, 251, 255, 0.2);
        }

        .neon-text-pink { text-shadow: 0 0 5px var(--neon-pink); color: var(--neon-pink); }
        .neon-border-pink { border-color: var(--neon-pink); box-shadow: 0 0 10px rgba(255, 0, 255, 0.2); }
        
        input, select, button {
            background: #111 !important;
            border: 1px solid var(--neon-blue) !important;
            color: white !important;
        }

        .tab-active {
            background: var(--neon-blue) !important;
            color: black !important;
            box-shadow: 0 0 15px var(--neon-blue);
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <header class="mb-8 border-b-2 border-pink-500 pb-4 flex justify-between items-end">
        <div>
            <h1 class="text-3xl font-bold neon-text-pink">SYSTEM: CYBER-CRM</h1>
            <p class="text-xs opacity-70">DATE: <span id="current-date"></span> | STATUS: ENCRYPTED</p>
        </div>
        <nav class="flex gap-2">
            <button onclick="switchTab('new')" id="btn-new" class="px-4 py-1 text-sm tab-active">新增</button>
            <button onclick="switchTab('retention')" id="btn-retention" class="px-4 py-1 text-sm">留存</button>
            <button onclick="switchTab('dashboard')" id="btn-dashboard" class="px-4 py-1 text-sm">看板</button>
        </nav>
    </header>

    <main>
        <section id="sec-new" class="space-y-6">
            <div class="cyber-card p-6 rounded-lg">
                <h2 class="mb-4 text-xl border-l-4 border-pink-500 pl-2">ENTRY / 新增录入</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs mb-1">姓名 / Alias</label>
                        <input type="text" id="form-name" class="w-full p-2 rounded" placeholder="请输入...">
                    </div>
                    <div>
                        <label class="block text-xs mb-1">渠道 / Channel</label>
                        <select id="form-channel" class="w-full p-2 rounded text-white">
                            <option>抖音</option><option>Tinder</option><option>Bumble</option>
                            <option>红书</option><option>积木</option><option>线下搭讪</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs mb-1">打分 / Rating (4-8)</label>
                        <select id="form-rating" class="w-full p-2 rounded">
                            </select>
                    </div>
                    <div>
                        <label class="block text-xs mb-1">标签 / Tag</label>
                        <select id="form-tag" class="w-full p-2 rounded">
                            <option>国女</option><option>S女</option><option>老登</option><option>精神小妹</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-xs mb-1">备注 / Intel</label>
                        <div class="flex gap-4 mt-2">
                            <label><input type="checkbox" value="窗口大" class="form-intel"> 窗口大</label>
                            <label><input type="checkbox" value="没兴趣" class="form-intel"> 没兴趣</label>
                        </div>
                    </div>
                </div>
                <button onclick="saveLead()" class="mt-6 w-full py-3 bg-pink-600 hover:bg-pink-500 transition-all font-bold">EXECUTE SAVE / 保存录入</button>
            </div>
        </section>

        <section id="sec-retention" class="hidden space-y-4">
            <div class="cyber-card p-4 rounded-lg neon-border-pink">
                <h3 class="text-pink-500 font-bold mb-2 flex items-center gap-2">
                    <i data-lucide="bell-ring" class="w-4 h-4"></i> 智能提醒 (T+7 待推进)
                </h3>
                <div id="reminder-list" class="text-sm space-y-2 text-gray-300">
                    </div>
            </div>
            
            <div id="lead-list" class="space-y-4">
                </div>
        </section>

        <section id="sec-dashboard" class="hidden space-y-6">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="cyber-card p-4 text-center">
                    <div class="text-xs opacity-70">今日新增</div>
                    <div id="stat-day" class="text-2xl font-bold text-pink-500">0</div>
                </div>
                <div class="cyber-card p-4 text-center">
                    <div class="text-xs opacity-70">本周新增</div>
                    <div id="stat-week" class="text-2xl font-bold text-pink-500">0</div>
                </div>
                <div class="cyber-card p-4 text-center">
                    <div class="text-xs opacity-70">本月新增</div>
                    <div id="stat-month" class="text-2xl font-bold text-pink-500">0</div>
                </div>
                <div class="cyber-card p-4 text-center border-pink-500">
                    <div class="text-xs opacity-70">目标达成</div>
                    <div id="stat-goal-pct" class="text-2xl font-bold text-white">0%</div>
                </div>
            </div>

            <div class="cyber-card p-6">
                <h3 class="mb-4 text-sm font-bold">CONVERSION FUNNEL / 转化漏斗</h3>
                <div id="funnel-container" class="space-y-2">
                    </div>
            </div>

            <div class="cyber-card p-6">
                <h3 class="mb-2 text-sm font-bold">SET GOAL / 手动设定月目标</h3>
                <input type="number" id="goal-input" class="p-2 w-32 mr-2" value="10">
                <button onclick="updateGoal()" class="px-4 py-2 bg-blue-600 text-xs">更新目标</button>
            </div>
        </section>
    </main>

    <script>
        // --- Core Data Logic ---
        let leads = JSON.parse(localStorage.getItem('cyber_leads') || '[]');
        let monthlyGoal = localStorage.getItem('cyber_goal') || 10;

        const STAGES = ["添加", "一约", "二约", "三约", "得吃", "放弃"];

        function init() {
            document.getElementById('current-date').innerText = new Date().toISOString().split('T')[0];
            renderRatingOptions();
            refreshUI();
            lucide.createIcons();
        }

        function renderRatingOptions() {
            const select = document.getElementById('form-rating');
            for(let i=4; i<=8; i+=0.5) {
                let opt = document.createElement('option');
                opt.value = i; opt.innerText = i;
                select.appendChild(opt);
            }
        }

        function saveLead() {
            const name = document.getElementById('form-name').value;
            if(!name) return alert("姓名必填");
            
            const newLead = {
                id: Date.now(),
                name,
                channel: document.getElementById('form-channel').value,
                rating: document.getElementById('form-rating').value,
                tag: document.getElementById('form-tag').value,
                intel: Array.from(document.querySelectorAll('.form-intel:checked')).map(el => el.value),
                stage: "添加",
                createdAt: new Date().getTime(),
                updatedAt: new Date().getTime()
            };

            leads.push(newLead);
            localStorage.setItem('cyber_leads', JSON.stringify(leads));
            alert("录入成功！");
            document.getElementById('form-name').value = '';
            refreshUI();
        }

        function updateStage(id, newStage) {
            leads = leads.map(l => l.id === id ? {...l, stage: newStage, updatedAt: new Date().getTime()} : l);
            localStorage.setItem('cyber_leads', JSON.stringify(leads));
            refreshUI();
        }

        function refreshUI() {
            renderRetention();
            renderDashboard();
            lucide.createIcons();
        }

        // --- View Logic ---
        function switchTab(tab) {
            ['new', 'retention', 'dashboard'].forEach(t => {
                document.getElementById(`sec-${t}`).classList.add('hidden');
                document.getElementById(`btn-${t}`).classList.remove('tab-active');
            });
            document.getElementById(`sec-${tab}`).classList.remove('hidden');
            document.getElementById(`btn-${tab}`).classList.add('tab-active');
        }

        function renderRetention() {
            const list = document.getElementById('lead-list');
            const reminderList = document.getElementById('reminder-list');
            list.innerHTML = '';
            reminderList.innerHTML = '';

            const now = new Date().getTime();
            const sevenDaysInMs = 7 * 24 * 60 * 60 * 1000;

            leads.sort((a,b) => b.updatedAt - a.updatedAt).forEach(l => {
                // Reminder Logic: T+7 and not finished/given up
                if (now - l.updatedAt > sevenDaysInMs && l.stage !== "得吃" && l.stage !== "放弃") {
                    reminderList.innerHTML += `<div class="flex justify-between border-b border-gray-800 pb-1">
                        <span>⚠️ ${l.name} (${l.tag})</span>
                        <span class="text-pink-400">已停滞7天+</span>
                    </div>`;
                }

                const card = document.createElement('div');
                card.className = 'cyber-card p-4 rounded flex justify-between items-center';
                card.innerHTML = `
                    <div>
                        <div class="font-bold text-lg">${l.name} <span class="text-xs font-normal opacity-60 ml-2">${l.channel} · ${l.rating}分</span></div>
                        <div class="text-xs text-blue-400">${l.tag} | ${l.intel.join(', ') || '无特殊备注'}</div>
                    </div>
                    <div class="flex gap-2">
                        <select onchange="updateStage(${l.id}, this.value)" class="text-xs p-1">
                            ${STAGES.map(s => `<option value="${s}" ${l.stage === s ? 'selected' : ''}>${s}</option>`).join('')}
                        </select>
                    </div>
                `;
                list.appendChild(card);
            });
            
            if(!reminderList.innerHTML) reminderList.innerHTML = "暂无待跟进提醒，保持节奏。";
        }

        function renderDashboard() {
            const now = new Date();
            const todayStr = now.toISOString().split('T')[0];
            
            const dayCount = leads.filter(l => new Date(l.createdAt).toISOString().split('T')[0] === todayStr).length;
            const monthCount = leads.filter(l => new Date(l.createdAt).getMonth() === now.getMonth()).length;
            
            document.getElementById('stat-day').innerText = dayCount;
            document.getElementById('stat-month').innerText = monthCount;
            document.getElementById('stat-goal-pct').innerText = Math.round((monthCount / monthlyGoal) * 100) + '%';

            // Funnel
            const funnelContainer = document.getElementById('funnel-container');
            funnelContainer.innerHTML = '';
            STAGES.forEach(s => {
                const count = leads.filter(l => l.stage === s).length;
                const pct = (count / (leads.length || 1)) * 100;
                funnelContainer.innerHTML += `
                    <div class="text-xs mb-1 flex justify-between"><span>${s}</span> <span>${count}</span></div>
                    <div class="w-full bg-gray-900 h-2 mb-3">
                        <div class="bg-blue-500 h-full" style="width: ${pct}%"></div>
                    </div>
                `;
            });
        }

        function updateGoal() {
            monthlyGoal = document.getElementById('goal-input').value;
            localStorage.setItem('cyber_goal', monthlyGoal);
            refreshUI();
        }

        init();
    </script>
</body>
</html>
