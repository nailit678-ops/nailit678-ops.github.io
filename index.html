<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>CYBER·CRM - 赛博朋克关系管理系统</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel Standalone -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <style>
    * {
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    
    @keyframes scan {
      0% { transform: translateY(-100%); }
      100% { transform: translateY(100%); }
    }
    
    .animate-scan {
      animation: scan 8s linear infinite;
    }
    
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    option {
      background: #000;
      color: #00ffff;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { Plus, Users, TrendingUp, X, BarChart3, Zap, Target, Activity } = lucide;

    // 本地存储工具函数
    const storage = {
      async list(prefix) {
        try {
          const keys = Object.keys(localStorage).filter(key => key.startsWith(prefix));
          return { keys };
        } catch (error) {
          return { keys: [] };
        }
      },
      
      async get(key) {
        try {
          const value = localStorage.getItem(key);
          return value ? { value } : null;
        } catch (error) {
          return null;
        }
      },
      
      async set(key, value) {
        try {
          localStorage.setItem(key, value);
          return { key, value };
        } catch (error) {
          return null;
        }
      },
      
      async delete(key) {
        try {
          localStorage.removeItem(key);
          return { key, deleted: true };
        } catch (error) {
          return null;
        }
      }
    };

    function CyberCRM() {
      const [contacts, setContacts] = useState([]);
      const [stats, setStats] = useState({ today: 0, total: 0, stages: {}, potential: 0, bigWindow: 0 });
      const [activeView, setActiveView] = useState('list');
      const [selectedContact, setSelectedContact] = useState(null);
      const [filterStage, setFilterStage] = useState('all');
      const [filterChannel, setFilterChannel] = useState('all');
      const [timeRange, setTimeRange] = useState('week');
      const [loading, setLoading] = useState(true);
      
      const [formData, setFormData] = useState({
        name: '',
        channel: '',
        stage: '初次添加',
        score: '',
        customTags: [],
        isPotential: false,
        isBigWindow: false,
        notes: '',
        addedDate: new Date().toISOString().split('T')[0]
      });

      const stages = ['初次添加', '一次邀约', '二次邀约', '三次邀约', '的吃', '放弃'];
      const commonChannels = ['积木/tinder', '线下搭讪', '抖音', '小红书'];
      const scoreOptions = ['4', '4.5', '5', '5.5', '6', '6.5', '7'];
      const customTagOptions = ['S', '国女', '留子', '玩得开'];

      useEffect(() => {
        loadContacts();
      }, []);

      useEffect(() => {
        calculateStats();
      }, [contacts, timeRange]);

      const loadContacts = async () => {
        setLoading(true);
        try {
          const result = await storage.list('cyber-contact:');
          if (result && result.keys) {
            const loadedContacts = await Promise.all(
              result.keys.map(async (key) => {
                try {
                  const data = await storage.get(key);
                  return data ? JSON.parse(data.value) : null;
                } catch (e) {
                  return null;
                }
              })
            );
            setContacts(loadedContacts.filter(c => c !== null));
          }
        } catch (error) {
          setContacts([]);
        }
        setLoading(false);
      };

      const getTimeRangeContacts = () => {
        const now = new Date();
        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        
        if (timeRange === 'week') {
          const weekAgo = new Date(today);
          weekAgo.setDate(weekAgo.getDate() - 7);
          return contacts.filter(c => new Date(c.addedDate) >= weekAgo);
        } else {
          const monthAgo = new Date(today);
          monthAgo.setMonth(monthAgo.getMonth() - 1);
          return contacts.filter(c => new Date(c.addedDate) >= monthAgo);
        }
      };

      const calculateStats = () => {
        const today = new Date().toISOString().split('T')[0];
        const rangeContacts = getTimeRangeContacts();
        
        const todayCount = contacts.filter(c => c.addedDate === today).length;
        const potentialCount = rangeContacts.filter(c => c.isPotential).length;
        const bigWindowCount = rangeContacts.filter(c => c.isBigWindow).length;
        
        const stageStats = {};
        stages.forEach(stage => {
          stageStats[stage] = rangeContacts.filter(c => c.stage === stage).length;
        });

        setStats({
          today: todayCount,
          total: contacts.length,
          rangeTotal: rangeContacts.length,
          stages: stageStats,
          potential: potentialCount,
          bigWindow: bigWindowCount
        });
      };

      const saveContact = async (contact) => {
        const id = contact.id || Date.now().toString();
        const contactData = { ...contact, id };
        
        try {
          await storage.set(`cyber-contact:${id}`, JSON.stringify(contactData));
          await loadContacts();
          return true;
        } catch (error) {
          alert('保存失败，请重试');
          return false;
        }
      };

      const deleteContact = async (id) => {
        try {
          await storage.delete(`cyber-contact:${id}`);
          await loadContacts();
        } catch (error) {
          alert('删除失败，请重试');
        }
      };

      const handleSubmit = async (e) => {
        e.preventDefault();
        const success = await saveContact(formData);
        if (success) {
          setFormData({
            name: '',
            channel: '',
            stage: '初次添加',
            score: '',
            customTags: [],
            isPotential: false,
            isBigWindow: false,
            notes: '',
            addedDate: new Date().toISOString().split('T')[0]
          });
          setActiveView('list');
        }
      };

      const handleEdit = (contact) => {
        setSelectedContact(contact);
        setFormData({
          ...contact,
          customTags: contact.customTags || []
        });
        setActiveView('add');
      };

      const toggleCustomTag = (tag) => {
        setFormData(prev => ({
          ...prev,
          customTags: (prev.customTags || []).includes(tag) 
            ? (prev.customTags || []).filter(t => t !== tag)
            : [...(prev.customTags || []), tag]
        }));
      };

      const filteredContacts = contacts.filter(contact => {
        if (filterStage !== 'all' && contact.stage !== filterStage) return false;
        if (filterChannel !== 'all' && contact.channel !== filterChannel) return false;
        return true;
      });

      const getStageColor = (stage) => {
        const colors = {
          '初次添加': 'from-cyan-500 to-blue-500',
          '一次邀约': 'from-purple-500 to-pink-500',
          '二次邀约': 'from-pink-500 to-rose-500',
          '三次邀约': 'from-yellow-500 to-orange-500',
          '的吃': 'from-green-500 to-emerald-500',
          '放弃': 'from-gray-500 to-gray-600'
        };
        return colors[stage] || 'from-gray-500 to-gray-600';
      };

      const getScoreGlow = (score) => {
        const glows = {
          '4': 'shadow-cyan-500/50',
          '4.5': 'shadow-blue-500/50',
          '5': 'shadow-indigo-500/50',
          '5.5': 'shadow-purple-500/50',
          '6': 'shadow-pink-500/50',
          '6.5': 'shadow-rose-500/50',
          '7': 'shadow-red-500/50'
        };
        return glows[score] || '';
      };

      const Icon = ({ icon: IconComponent, ...props }) => {
        return <IconComponent {...props} />;
      };

      if (loading) {
        return (
          <div className="min-h-screen bg-black text-white flex items-center justify-center">
            <div className="text-center">
              <div className="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-purple-400 to-pink-400 animate-pulse mb-4"
                   style={{fontFamily: 'Orbitron, monospace'}}>
                CYBER·CRM
              </div>
              <div className="text-cyan-400/50">加载中...</div>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-black text-white relative overflow-hidden">
          {/* 赛博朋克背景 */}
          <div className="fixed inset-0 opacity-20 pointer-events-none">
            <div className="absolute inset-0" style={{
              backgroundImage: `
                linear-gradient(90deg, rgba(0,255,255,0.1) 1px, transparent 1px),
                linear-gradient(rgba(0,255,255,0.1) 1px, transparent 1px)
              `,
              backgroundSize: '50px 50px'
            }}/>
            <div className="absolute inset-0 bg-gradient-to-b from-purple-900/20 via-transparent to-cyan-900/20"/>
          </div>

          {/* 扫描线效果 */}
          <div className="fixed inset-0 pointer-events-none opacity-10">
            <div className="w-full h-full bg-gradient-to-b from-transparent via-cyan-500/10 to-transparent animate-scan"/>
          </div>

          {/* 顶部导航 */}
          <div className="relative bg-black/80 backdrop-blur-xl border-b-2 border-cyan-500/30 sticky top-0 z-50">
            <div className="max-w-2xl mx-auto px-4 py-4">
              <div className="flex items-center justify-between mb-4">
                <h1 className="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-purple-400 to-pink-400"
                    style={{fontFamily: 'Orbitron, monospace', letterSpacing: '2px'}}>
                  CYBER·CRM
                </h1>
                <div className="flex gap-2">
                  <button 
                    onClick={() => setActiveView('stats')}
                    className={`p-2.5 rounded-lg transition-all ${
                      activeView === 'stats' 
                        ? 'bg-cyan-500/30 text-cyan-400 shadow-lg shadow-cyan-500/50' 
                        : 'bg-cyan-500/10 text-cyan-400 hover:bg-cyan-500/20'
                    }`}>
                    <Icon icon={BarChart3} size={20} />
                  </button>
                  <button 
                    onClick={() => {
                      setFormData({
                        name: '',
                        channel: '',
                        stage: '初次添加',
                        score: '',
                        customTags: [],
                        isPotential: false,
                        isBigWindow: false,
                        notes: '',
                        addedDate: new Date().toISOString().split('T')[0]
                      });
                      setSelectedContact(null);
                      setActiveView('add');
                    }}
                    className="p-2.5 rounded-lg bg-gradient-to-r from-cyan-500 to-purple-500 text-white shadow-lg shadow-cyan-500/50 hover:shadow-xl transition-all">
                    <Icon icon={Plus} size={20} />
                  </button>
                </div>
              </div>
              
              {/* 快速统计 */}
              <div className="grid grid-cols-3 gap-3">
                <div className="bg-black/40 backdrop-blur-sm border border-cyan-500/30 rounded-xl p-3 shadow-lg shadow-cyan-500/10">
                  <div className="text-cyan-400/70 text-xs mb-1">今日新增</div>
                  <div className="text-2xl font-bold text-cyan-400" style={{textShadow: '0 0 10px currentColor'}}>
                    {stats.today}
                  </div>
                </div>
                <div className="bg-black/40 backdrop-blur-sm border border-purple-500/30 rounded-xl p-3 shadow-lg shadow-purple-500/10">
                  <div className="text-purple-400/70 text-xs mb-1">有潜力</div>
                  <div className="text-2xl font-bold text-purple-400" style={{textShadow: '0 0 10px currentColor'}}>
                    {stats.potential}
                  </div>
                </div>
                <div className="bg-black/40 backdrop-blur-sm border border-pink-500/30 rounded-xl p-3 shadow-lg shadow-pink-500/10">
                  <div className="text-pink-400/70 text-xs mb-1">窗口大</div>
                  <div className="text-2xl font-bold text-pink-400" style={{textShadow: '0 0 10px currentColor'}}>
                    {stats.bigWindow}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div className="relative max-w-2xl mx-auto px-4 py-4">
            {/* 列表视图 */}
            {activeView === 'list' && (
              <div className="space-y-4">
                {/* 筛选器 */}
                <div className="flex gap-2">
                  <select 
                    value={filterStage}
                    onChange={(e) => setFilterStage(e.target.value)}
                    className="flex-1 px-3 py-2 bg-black/50 border border-cyan-500/30 text-cyan-400 rounded-lg focus:outline-none focus:border-cyan-500 focus:shadow-lg focus:shadow-cyan-500/50 transition-all">
                    <option value="all">全部阶段</option>
                    {stages.map(stage => (
                      <option key={stage} value={stage}>{stage}</option>
                    ))}
                  </select>
                  <select 
                    value={filterChannel}
                    onChange={(e) => setFilterChannel(e.target.value)}
                    className="flex-1 px-3 py-2 bg-black/50 border border-cyan-500/30 text-cyan-400 rounded-lg focus:outline-none focus:border-cyan-500 focus:shadow-lg focus:shadow-cyan-500/50 transition-all">
                    <option value="all">全部渠道</option>
                    {commonChannels.map(channel => (
                      <option key={channel} value={channel}>{channel}</option>
                    ))}
                  </select>
                </div>

                {/* 联系人列表 */}
                {filteredContacts.length === 0 ? (
                  <div className="text-center py-20">
                    <Icon icon={Users} size={64} className="mx-auto mb-4 text-cyan-500/30" />
                    <p className="text-cyan-400/50 text-lg font-bold">NO DATA FOUND</p>
                    <p className="text-cyan-400/30 text-sm mt-2">点击右上角 + 添加新联系人</p>
                  </div>
                ) : (
                  filteredContacts.map(contact => (
                    <div 
                      key={contact.id}
                      onClick={() => handleEdit(contact)}
                      className="bg-black/40 backdrop-blur-sm border border-cyan-500/30 hover:border-cyan-500/50 rounded-xl p-4 cursor-pointer transition-all hover:shadow-lg hover:shadow-cyan-500/20 active:scale-[0.98]">
                      <div className="flex justify-between items-start mb-3">
                        <div className="flex-1">
                          <div className="flex items-center gap-2 flex-wrap">
                            <h3 className="font-bold text-xl text-white">{contact.name}</h3>
                            {contact.score && (
                              <span className={`text-xs px-2 py-1 bg-black/70 border border-cyan-500/50 rounded-full font-bold text-white shadow-lg ${getScoreGlow(contact.score)}`}>
                                {contact.score}
                              </span>
                            )}
                          </div>
                          <div className="flex items-center gap-2 mt-2 text-sm flex-wrap">
                            <span className="text-cyan-400/70 border border-cyan-500/30 px-2 py-0.5 rounded text-xs">
                              {contact.channel}
                            </span>
                            <span className="text-cyan-400/30">•</span>
                            <span className="text-cyan-400/50 text-xs">{contact.addedDate}</span>
                          </div>
                        </div>
                        <div className={`text-xs px-3 py-1.5 rounded-full font-bold text-white shadow-lg bg-gradient-to-r ${getStageColor(contact.stage)}`}
                             style={{boxShadow: '0 0 15px currentColor'}}>
                          {contact.stage}
                        </div>
                      </div>
                      
                      <div className="flex gap-2 mt-3 flex-wrap">
                        {contact.isPotential && (
                          <span className="flex items-center gap-1 text-xs bg-purple-500/20 text-purple-400 px-2 py-1 rounded border border-purple-500/30">
                            <Icon icon={Zap} size={12} />
                            有潜力
                          </span>
                        )}
                        {contact.isBigWindow && (
                          <span className="flex items-center gap-1 text-xs bg-pink-500/20 text-pink-400 px-2 py-1 rounded border border-pink-500/30">
                            <Icon icon={Target} size={12} />
                            窗口大
                          </span>
                        )}
                        {contact.customTags && contact.customTags.length > 0 && (
                          contact.customTags.map(tag => (
                            <span key={tag} className="text-xs bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded border border-yellow-500/30">
                              #{tag}
                            </span>
                          ))
                        )}
                      </div>
                      
                      {contact.notes && (
                        <p className="text-sm text-cyan-400/60 mt-3 line-clamp-2 border-t border-cyan-500/10 pt-2">
                          {contact.notes}
                        </p>
                      )}
                    </div>
                  ))
                )}
              </div>
            )}

            {/* 添加/编辑视图 */}
            {activeView === 'add' && (
              <div className="bg-black/40 backdrop-blur-sm border border-cyan-500/50 rounded-xl p-5 shadow-2xl shadow-cyan-500/20">
                <div className="flex justify-between items-center mb-5">
                  <h2 className="text-xl font-bold text-cyan-400">
                    {selectedContact ? '[ 编辑联系人 ]' : '[ 新建联系人 ]'}
                  </h2>
                  <button 
                    onClick={() => setActiveView('list')}
                    className="p-2 bg-cyan-500/10 hover:bg-cyan-500/20 text-cyan-400 rounded-lg transition-all">
                    <Icon icon={X} size={20} />
                  </button>
                </div>

                <form onSubmit={handleSubmit} className="space-y-4">
                  <div>
                    <label className="block text-cyan-400 text-sm font-bold mb-2 uppercase tracking-wider">姓名</label>
                    <input
                      type="text"
                      value={formData.name}
                      onChange={(e) => setFormData({...formData, name: e.target.value})}
                      className="w-full px-3 py-2.5 bg-black/50 border border-cyan-500/30 text-cyan-400 rounded-lg focus:outline-none focus:border-cyan-500 focus:shadow-lg focus:shadow-cyan-500/50 transition-all"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-cyan-400 text-sm font-bold mb-2 uppercase tracking-wider">来源渠道</label>
                    <select
                      value={formData.channel}
                      onChange={(e) => setFormData({...formData, channel: e.target.value})}
                      className="w-full px-3 py-2.5 bg-black/50 border border-cyan-500/30 text-cyan-400 rounded-lg focus:outline-none focus:border-cyan-500 focus:shadow-lg focus:shadow-cyan-500/50 transition-all"
                      required>
                      <option value="">选择渠道</option>
                      {commonChannels.map(channel => (
                        <option key={channel} value={channel}>{channel}</option>
                      ))}
                    </select>
                  </div>

                  <div>
                    <label className="block text-cyan-400 text-sm font-bold mb-2 uppercase tracking-wider">当前阶段</label>
                    <div className="grid grid-cols-2 gap-2">
                      {stages.map(stage => (
                        <button
                          key={stage}
                          type="button"
                          onClick={() => setFormData({...formData, stage})}
                          className={`py-2.5 px-3 rounded-lg font-bold text-sm transition-all bg-gradient-to-r ${getStageColor(stage)} ${
                            formData.stage === stage 
                              ? 'opacity-100 border-2 border-white shadow-lg' 
                              : 'opacity-50 border-2 border-transparent'
                          }`}
                          style={formData.stage === stage ? {boxShadow: '0 0 20px currentColor'} : {}}>
                          {stage}
                        </button>
                      ))}
                    </div>
                  </div>

                  <div>
                    <label className="block text-cyan-400 text-sm font-bold mb-2 uppercase tracking-wider">评分</label>
                    <div className="grid grid-cols-4 gap-2">
                      {scoreOptions.map(score => (
                        <button
                          key={score}
                          type="button"
                          onClick={() => setFormData({...formData, score})}
                          className={`py-3 px-3 rounded-lg font-bold text-lg transition-all ${
                            formData.score === score 
                              ? 'bg-gradient-to-r from-cyan-500 to-purple-500 text-white border-0 shadow-xl' 
                              : 'bg-black/50 text-cyan-400 border-2 border-cyan-500/30'
                          }`}
                          style={formData.score === score ? {boxShadow: '0 0 30px rgba(0,255,255,0.5)'} : {}}>
                          {score}
                        </button>
                      ))}
                    </div>
                  </div>

                  <div>
                    <label className="block text-cyan-400 text-sm font-bold mb-2 uppercase tracking-wider">用户标签</label>
                    <div className="grid grid-cols-2 gap-2">
                      {customTagOptions.map(tag => (
                        <button
                          key={tag}
                          type="button"
                          onClick={() => toggleCustomTag(tag)}
                          className={`py-2.5 px-3 rounded-lg font-bold text-sm transition-all ${
                            (formData.customTags || []).includes(tag)
                              ? 'bg-gradient-to-r from-yellow-500 to-orange-500 text-white border-2 border-yellow-300 shadow-lg' 
                              : 'bg-yellow-500/10 text-yellow-400 border border-yellow-500/30 hover:bg-yellow-500/20'
                          }`}
                          style={(formData.customTags || []).includes(tag) ? {boxShadow: '0 0 20px rgba(234,179,8,0.5)'} : {}}>
                          {tag}
                        </button>
                      ))}
                    </div>
                  </div>

                  <div>
                    <label className="block text-cyan-400 text-sm font-bold mb-2 uppercase tracking-wider">添加日期</label>
                    <input
                      type="date"
                      value={formData.addedDate}
                      onChange={(e) => setFormData({...formData, addedDate: e.target.value})}
                      className="w-full px-3 py-2.5 bg-black/50 border border-cyan-500/30 text-cyan-400 rounded-lg focus:outline-none focus:border-cyan-500 focus:shadow-lg focus:shadow-cyan-500/50 transition-all"
                      required
                    />
                  </div>

                  <div className="flex gap-3">
                    <label className="flex-1 flex items-center gap-2 bg-black/50 border border-cyan-500/30 px-3 py-3 rounded-lg cursor-pointer transition-all hover:bg-cyan-500/10 has-[:checked]:bg-cyan-500/20 has-[:checked]:border-cyan-500 has-[:checked]:shadow-lg has-[:checked]:shadow-cyan-500/50">
                      <input
                        type="checkbox"
                        checked={formData.isPotential}
                        onChange={(e) => setFormData({...formData, isPotential: e.target.checked})}
                        className="w-5 h-5"
                      />
                      <span className="flex items-center gap-2 text-cyan-400 font-bold text-sm">
                        <Icon icon={Zap} size={16} />
                        有潜力
                      </span>
                    </label>
                    <label className="flex-1 flex items-center gap-2 bg-black/50 border border-cyan-500/30 px-3 py-3 rounded-lg cursor-pointer transition-all hover:bg-cyan-500/10 has-[:checked]:bg-cyan-500/20 has-[:checked]:border-cyan-500 has-[:checked]:shadow-lg has-[:checked]:shadow-cyan-500/50">
                      <input
                        type="checkbox"
                        checked={formData.isBigWindow}
                        onChange={(e) => setFormData({...formData, isBigWindow: e.target.checked})}
                        className="w-5 h-5"
                      />
                      <span className="flex items-center gap-2 text-cyan-400 font-bold text-sm">
                        <Icon icon={Target} size={16} />
                        窗口大
                      </span>
                    </label>
                  </div>

                  <div>
                    <label className="block text-cyan-400 text-sm font-bold mb-2 uppercase tracking-wider">备注</label>
                    <textarea
                      value={formData.notes}
                      onChange={(e) => setFormData({...formData, notes: e.target.value})}
                      className="w-full px-3 py-2.5 bg-black/50 border border-cyan-500/30 text-cyan-400 rounded-lg focus:outline-none focus:border-cyan-500 focus:shadow-lg focus:shadow-cyan-500/50 transition-all"
                      rows="3"
                      placeholder="记录一些重要信息..."
                    />
                  </div>

                  <div className="flex gap-3 pt-3">
                    {selectedContact && (
                      <button
                        type="button"
                        onClick={() => {
                          if (confirm('确定要删除这个联系人吗？')) {
                            deleteContact(selectedContact.id);
                            setActiveView('list');
                          }
                        }}
                        className="flex-1 py-3 bg-red-500/20 hover:bg-red-500/30 text-red-400 border border-red-500/50 rounded-lg font-bold transition-all">
                        删除
                      </button>
                    )}
                    <button
                      type="submit"
                      className="flex-1 py-3 bg-gradient-to-r from-cyan-500 to-purple-500 text-white rounded-lg font-bold text-lg shadow-lg shadow-cyan-500/50 hover:shadow-xl transition-all">
                      {selectedContact ? '保存修改' : '添加'}
                    </button>
                  </div>
                </form>
              </div>
            )}

            {/* 统计视图 */}
            {activeView === 'stats' && (
              <div className="space-y-4">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-xl font-bold text-cyan-400">[ 数据分析 ]</h2>
                  <button 
                    onClick={() => setActiveView('list')}
                    className="p-2 bg-cyan-500/10 hover:bg-cyan-500/20 text-cyan-400 rounded-lg transition-all">
                    <Icon icon={X} size={20} />
                  </button>
                </div>

                {/* 时间维度选择 */}
                <div className="bg-black/40 backdrop-blur-sm border border-cyan-500/50 rounded-xl p-4 shadow-lg">
                  <div className="flex gap-2">
                    <button
                      onClick={() => setTimeRange('week')}
                      className={`flex-1 py-3 px-4 rounded-lg font-bold transition-all ${
                        timeRange === 'week' 
                          ? 'bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-lg shadow-cyan-500/50' 
                          : 'bg-cyan-500/10 text-cyan-400 border border-cyan-500/30 hover:bg-cyan-500/20'
                      }`}>
                      本周
                    </button>
                    <button
                      onClick={() => setTimeRange('month')}
                      className={`flex-1 py-3 px-4 rounded-lg font-bold transition-all ${
                        timeRange === 'month' 
                          ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg shadow-purple-500/50' 
                          : 'bg-purple-500/10 text-purple-400 border border-purple-500/30 hover:bg-purple-500/20'
                      }`}>
                      本月
                    </button>
                  </div>
                  <div className="text-center mt-4">
                    <div className="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400">
                      {stats.rangeTotal}
                    </div>
                    <div className="text-cyan-400/50 text-sm mt-1">
                      {timeRange === 'week' ? '本周新增' : '本月新增'}
                    </div>
                  </div>
                </div>

                {/* 阶段分布 */}
                <div className="bg-black/40 backdrop-blur-sm border border-cyan-500/30 rounded-xl p-5 shadow-lg">
                  <h3 className="font-bold text-cyan-400 mb-4 flex items-center gap-2">
                    <Icon icon={Activity} size={18} />
                    阶段分布
                  </h3>
                  <div className="space-y-3">
                    {stages.map(stage => {
                      const count = stats.stages[stage] || 0;
                      const percentage = stats.rangeTotal > 0 ? (count / stats.rangeTotal * 100).toFixed(1) : 0;
                      return (
                        <div key={stage}>
                          <div className="flex justify-between text-sm mb-1.5">
                            <span className="text-cyan-400/80">{stage}</span>
                            <span className="text-cyan-400/60">{count}人 ({percentage}%)</span>
                          </div>
                          <div className="w-full bg-black/50 rounded-full h-2.5 border border-cyan-500/20">
                            <div 
                              className={`h-full rounded-full transition-all duration-500 bg-gradient-to-r ${getStageColor(stage)}`}
                              style={{
                                width: `${percentage}%`,
                                boxShadow: '0 0 15px currentColor'
                              }}
                            />
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>

                {/* 渠道统计 */}
                <div className="bg-black/40 backdrop-blur-sm border border-purple-500/30 rounded-xl p-5 shadow-lg">
                  <h3 className="font-bold text-purple-400 mb-4">渠道来源</h3>
                  <div className="space-y-2">
                    {commonChannels.map(channel => {
                      const rangeContacts = getTimeRangeContacts();
                      const count = rangeContacts.filter(c => c.channel === channel).length;
                      if (count === 0) return null;
                      return (
                        <div key={channel} className="flex justify-between text-sm py-2.5 border-b border-cyan-500/10 last:border-0">
                          <span className="text-cyan-400/70">{channel}</span>
                          <span className="font-bold text-purple-400">{count}人</span>
                        </div>
                      );
                    })}
                  </div>
                </div>

                {/* 转化漏斗 */}
                <div className="bg-black/40 backdrop-blur-sm border border-pink-500/30 rounded-xl p-5 shadow-lg">
                  <h3 className="font-bold text-pink-400 mb-5">转化漏斗</h3>
                  <div className="space-y-3">
                    {['初次添加', '一次邀约', '二次邀约', '三次邀约', '的吃'].map((stage, index, arr) => {
                      const count = stats.stages[stage] || 0;
                      const prevCount = index > 0 ? (stats.stages[arr[index - 1]] || 0) : stats.rangeTotal;
                      const conversionRate = prevCount > 0 ? ((count / prevCount) * 100).toFixed(1) : 0;
                      
                      return (
                        <div key={stage}>
                          <div className="text-center bg-gradient-to-r from-black/50 to-black/30 rounded-lg p-4 border border-cyan-500/20">
                            <div className={`text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r ${getStageColor(stage)}`}>
                              {count}
                            </div>
                            <div className="text-xs text-cyan-400/60 mt-1">{stage}</div>
                            {index > 0 && (
                              <div className="text-xs text-purple-400/60 mt-2">
                                转化率: {conversionRate}%
                              </div>
                            )}
                          </div>
                          {index < arr.length - 1 && (
                            <div className="text-center text-cyan-400/30 text-2xl">↓</div>
                          )}
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    // 渲染应用
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<CyberCRM />);

    // 初始化 Lucide icons
    lucide.createIcons();
  </script>
</body>
</html>